[Command]
Command="
    copyq:
    const userTags = plugins.itemtags.userTags || [];
    const tagsMime = 'application/x-copyq-tags';
    const tagSeparator = ', ';
    const timeMime = 'application/x-copyq-user-time';

    const dialogTitle = 'Detailed Copy';
    const tabField = '&Target Tab';
    const tagField = '&Add Tag';
    const notesField = '&Notes';
    const contentField = '&Item Content';
    const dialogWidth = 400;
    const dialogHeight = 300;

    const selectedItem = selectedItemData(0) || {};
    const currentTime = new Date().toISOString();
    const currentTags = str(selectedItem[tagsMime] || '');
    const currentNotes = str(selectedItem[mimeItemNotes] || '');
    var currentText = str(selectedItem[mimeText] || '');

    if (!currentText) {
      try {
        sleep(200);
        copy();
        currentText = str(clipboard());
      } catch (e) {}
    }

    const fields = [
      tabField, tab(),
      tagField, userTags.map((t) => str(t)),
      // add new line to enable fake vim mode
      notesField, currentNotes + '\\n',
      contentField, currentText + '\\n',
    ];

    const newFields = dialog.apply(
      this,
      [
        '.width', dialogWidth,
        '.height', dialogHeight,
        '.title', dialogTitle,
      ].concat(fields)
    );

    if (!newFields) {
      abort();
    }

    parseValue = (data) => {
      var hasValue = !/^\\s*$/.test(data);
      if (hasValue) {
        // remove trailing new lines
        return data.replace(/\\n*$/, '');
      }
      return '';
    };

    const newTag = parseValue(newFields[tagField]);
    const newTags = currentTags ? currentTags + tagSeparator + newTag : newTag;
    const newTab = parseValue(newFields[tabField]) || config('clipboard_tab');
    const newNotes = parseValue(newFields[notesField]);
    const newText = parseValue(newFields[contentField]);

    const tagChanged = newTag && !currentTags.split(tagSeparator).includes(newTag);
    const notesChanged = newNotes !== currentNotes;
    const contentChanged = newText !== parseValue(currentText);

    if (!tagChanged && !notesChanged && !contentChanged) {
      abort();
    }

    var item = {
      [tagsMime]: newTags,
      [mimeItemNotes]: newNotes,
      [mimeText]: newText,
      [timeMime]: currentTime,
    };

    tab(newTab);
    add(item);"
GlobalShortcut=meta+ctrl+c
Icon=\xf46d
InMenu=true
IsGlobalShortcut=true
Name=Detailed Copy
Shortcut=meta+ctrl+c
