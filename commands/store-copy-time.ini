[Command]
Command="
    'use strict';

    const timeFormat = 'yyyy-MM-dd hh:mm:ss';
    const timeMatchRegExp = /^\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}$/;
    const mimeTags = 'application/x-copyq-tags';

    function setSelectionTime() {
        const sel = ItemSelection().current();
        if (sel.length !== 1) { return; }

        const oldTags = sel.itemsFormat(mimeTags);
        if (oldTags.length !== 1) { return; }

        let tags = str(oldTags[0] || '').split(',').map(x => x.trim());
        const time = dateString(timeFormat);
        if (tags.includes(time)) { return; }

        tags = tags.filter(x => x !== '' && !timeMatchRegExp.test(x));
        tags.push(time);
        sel.setItemsFormat(mimeTags, tags.join(', '));
    }

    const onItemsAdded_ = onItemsAdded;
    onItemsAdded = function() {
        setSelectionTime();
        return onItemsAdded_();
    };

    const onItemsChanged_ = onItemsChanged;
    onItemsChanged = function() {
        setSelectionTime();
        return onItemsChanged_();
    };"
Icon=ï€—
IsScript=true
Name=Show Copy Time
