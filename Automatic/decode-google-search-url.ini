[Command]
Name=Decode Google Search URL
Automatic=true
Command="
    copyq:
    var url = str(clipboard())
    var result = execute(
      '/bin/python',
      '-c',
        'try:\\n' +
        '  from urllib.parse import urlparse, parse_qs, unquote\\n' +
        'except ImportError:\\n' +
        '  from urlparse import urlparse, parse_qs\\n' +
        '  from urllib import unquote\\n' +
        'import sys\\n' +
        'url = sys.argv[1]\\n' +
        'parsed_url = urlparse(url)\\n' +
        'qs = parse_qs(parsed_url.query)\\n' +
        'if \"url\" in qs:\\n' +
        '  print(unquote(qs[\"url\"][0]))',
      url
    )
    if (
      result &&
      result.exit_code == 0 &&
      str(result.stdout)
    ) {
      add(url)
      var stdout = str(result.stdout)
      add(stdout)
      copy(stdout)
    } else {
      add(url)
      copy(url)
    }"
Icon=\xf044
Match=^https?:\\/\\/(www\\.)?google\\.com\\/url\\?
Output=text/plain
Transform=true
